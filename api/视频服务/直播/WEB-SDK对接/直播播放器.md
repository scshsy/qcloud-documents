## 功能介绍

腾讯云视频直播播放器Web SDK解决方案，可帮助腾讯云视频用户直接使用经过验证的视频播放能力，通过灵活的接口，快速同自有Web应用集成，以实现桌面应用播放功能。同时SDK提供在WEB端上传视频的能力。<br>
该SDK所播放的文件受限于全局防盗链功能定义。详细内容请查看官网FAQ安全功能相关说明。<br>
该文档面向考虑使用腾讯云视频直播播放器Web SDK进行开发并具备Javascript语言基础的开发人员。



## 格式支持


### 播放格式
WEB SDK直播视频格式支持：

|播放格式    | PC浏览器   | 移动端浏览器 |
|-------------|------|--------|
| HLS（m3u8） | 支持 | 支持   |
| RTMP        | 支持 | 不支持 |
| FLV         | 支持 | 支持   |

> **Android 系统兼容性问题**
> 不像iPhone上只有一个Safari浏览器，Android上的系统标配浏览器有非常多的实现版本，所以Android手机浏览器的兼容是一个业界难题，故此表格中所示的手机浏览器格式支持情况比**不适用于所有Android手机**。




## 准备工作

### step 1: 开通服务
注册腾讯云帐号，并开通**直播**服务
### step 2:创建频道
进入直播管理控制台并创建直播频道<br>[直播视频管理](https://console.qcloud.com/live)
### step 3: 获取ID
您可以在直播管理控制台查找到直播频道并对该频道进行管理
![](//mc.qcloudimg.com/static/img/43af1f0aa5ee6b43661e2da8abee10dd/image.png)

在**基础设置**中，可以查询到该频道的播放器代码，并获取该频道的频道id和app_id。
![](//mc.qcloudimg.com/static/img/e1306201d719498277c584b490c8974d/image.png)
### step 4: 页面准备
在需要播放视频的页面（包括PC或H5）中引入初始化脚本


```
<script src="//qzonestyle.gtimg.cn/open/qcloud/video/live/h5/live_connect.js" charset="utf-8"></script>;
```



>注意事项：播放页面需要挂ip或域名访问，如若直接打开本地静态页面将无法播放

> 备注：另外可以通过服务端API获取频道ID和APPID，[参考文档链接](https://www.qcloud.com/doc/api/258/4714)


## API基础使用方法

### step 1: 添加播放器容器

 在需要展示播放器的页面位置加入播放器容器

 例如：在index.html中加入如下代码
```
<div id="id_video_container" style="width:100%; height:auto;"></div>
```
容器id以及宽高都可以自定义。

### step 2: 创建Player 对象

接下来在页面底部引入的Javascript脚本中，创建一个播放器对象，这时将使用播放器的构造函数
```
var player = new qcVideo.Player("id_video_container", {
"channel_id": "16093104850682282610",
"app_id": "1251783440",
"width" : 480,
"height" : 320
});
```
调用构造函数将会生成一个播放器对象，并且根据channel\_id和app\_id找到对应的直播视频流进行播放，您可以使用播放器对象player 对播放器进行控制。播放器对象的参数选项下方API方法总览有详细介绍。



## API使用案例

>说明：使用API需先完成[第4部分API基础使用方法](#basic_use)中的[step1](#step1)部分，添加播放器容器完成后再进行API使用

### case 1:  在PC或移动端（H5）中播放直播视频

直播SDK在PC和H5中的使用方式是一样的，sdk会自动区分平台使用最优的播放方案，例如PC平台优先使用Flash 播放器以适应多种视频格式的情况，H5只能使用video标签进行播放。SDK同时支持传频道ID或视频文件地址的方式播放，
> 备注：两种播放方式不能混合使用。

### case 2: 使用频道ID播放视频
```
var option = {
"channel_id": "16093425727656143421",
"app_id": "1251132611",
"width" : 480,
"height" : 320

//...可选填其他属性
};

var player = new qcVideo.Player("id_video_container", option);
```
### case 3: 使用直播视频地址播放视频
```
var option = {
"live_url" : "http://2157.liveplay.myqcloud.com/2157_358535a.m3u8",
"live_url2" : "http://2000.liveplay.myqcloud.com/live/2000_2a1_550.flv",
"width" : 480,
"height" : 320

//...可选填其他属性
};

var player = new qcVideo.Player("id_video_container", option);
```
> 备注：最多支持传入两个播放地址，live\_url，live\_url2 ；如果这两个地址都传了，那么会按平台支持最好的一个地址选择进行播放。例如： 当前环境是pc，那么会优先选择其中为rtmp或flv的格式；当前环境为手机H5，会优先选择 hls格式进行播放。



##  API方法总览

### 1. 构造函数

```
qcVideo.Player(id, option);
```

 **id**: String ;  <font color="red">必选</font>参数; 页面放置播放器的容器ID，可以自由定义。

  **option**: Object ; <font color="red">必选</font>参数; 播放器的参数可设置选项，具体选项：

| 参数             | 类型   | 默认值 | 参数说明   |
|------------------|--------|--------|---------------------------------------------------------------------------------------------------|
| channel\_id      | String | 无     | 用直播视频ID播放方式为<font color="red">必选</font>参数                                                                    |
| app\_id          | String | 无     | 条件同上为<font color="red">必选</font>参数，同一个账户下的视频，该参数是相同的                                            |
| width            | Number | 无     | <font color="red">必选</font>，例如：640，设置播放器宽度，单位为像素                                                       |
| height           | Number | 无     | <font color="red">必选</font>，例如：480，设置播放器高度，单位为像素                                                       |
| cache\_time      | Number | 0.3    | 直播画面开始播放前，最大缓存时间 ; 这个属性可避免有效下行带宽不足导致免rtmp直播卡顿的情况(可选参数)<br> 备注：该选项只对Flash播放器生效   |
| h5\_start\_patch | Object | 无     | h5播放，开始播放前贴片(可选参数)<br>{ <br>url : 图片地址, <br>stretch: false //是否拉伸图片铺面整个播放器，默认false<br>}                                                                                                  |
| wording          | Object | 无     | 直播提示语自定义（目前仅支持h5播放模式）(可选参数)<br>{<br>'10000': '请求超时,请检查网络设置', <br>'11046': '密码错误，请重新输入',<br>'20110': '密码错误，请重新输入',<br>'20113': '直播源不存在(20113)', <br>'1009': '直播源已失效(1009)',<br>'3': '直播源已结束', <br>'1001': '无效参数', <br>TIP\_REQUIRE\_SAFARI: '当前浏览器不能支持视频播放,请使用safari打开观看', <br>TIP\_REQUIRE\_FLASH: '当前浏览器不能支持视频播放，可下载最新的QQ浏览器或者安装FLASH即可播放' <br>}                                                                                                 |
| live\_url        | String | 无     | 直播地址，支持hls/rtmp/flv三种格式<br>用视频地址播放方式为<font color="red">必选参数</font>                                                                       |
| live\_url2       | String | 无     | 直播地址，同上（可选参数）                                                                        |
| volume           | Number | 0.5    | 设置音量初始值0 到 1，默认0.5。（可选参数）<br>备注：该选项只对Flash播放器生效                                                                    |

### 2. 获取参数和状态

构造函数返回的播放器对象具有以下获取参数和状态的方法

| 方法名      | 返回值                     | 说明               |
|-------------|----------------------------|--------------------|
| getVolume   | Number，取值范围（0 到 1） | 获取当前音量       |
| getDuration | Number，单位秒             | 获取当前视频总时长 |

### 3. 设置和动作

构造函数返回的播放器对象具有以下设置方法

| 方法                 | 说明                          |
|----------------------|-------------------------------|
| resize(width,height) | 参数：width :int；height :int <br>功能：设置当前播放器宽度高度<br>返回：无                       |
| play()                                                  | 功能：开始播放<br>返回：Int(统一返回码)                                                            |
| stop()                                                  | 功能：停止播放<br>返回：Int(统一返回码)                                                              |
| pause()                                                       | 功能：暂停当前播放的视频 <br>返回：Int(统一返回码)                                                                             |
| resume()                                                      | 功能：恢复播放视频<br>返回：Int(统一返回码)   

这些设置方法的统一返回码是：
  
| 错误码 | 含义 |
|---------|---------|
| 200 | 操作成功 | 
| 0  | 播放器未完全初始化 | 
| -2 | 未知操作命令 | 


## 问题排查

### 错误码列表

SDK使用过程中出现的异常code对照表

- 前端返回错误

| 描述  | 说明                                       |
|-------|--------------------------------------------|
|连接服务失败|获取视频频道信息失败|
|服务被拒绝   |发起请求的站点不受信任（如跨域问题等）|
|解析视频出错|视频数据解析出错|
|数据错误：错误码|请根据错误码查找后台返回错误|
|缺少视频数据|视频源数据缺失|
|连接直播源失败 |直播无输入流|
|连接直播源失败 |直播已关闭|

- 后台返回错误

| Code  | 说明                                       |
|-------|--------------------------------------------|
| 2     | 无法获取m3u8文件，连接不到直播源           |
| 3     | Manifest不是合法的m3u8文件，或直播源已结束 |
|114   |除app_id和channel_id之外，存在参数错误|
|1000 |app_id填写错误（长度错误）|
|1001 |app_id填写错误（长度正确，内容错误）|
| 1003  | 密码错误                                   |
| 1009  | 无效播放地址，直播源已失效                 |
|2048  | 使用live_url连接，url域名错误
| 10000 | 请求超时                                   |
| 10008 | Channel ID 错误                            |
| 11044 | 缺少APPID                                  |
| 11045 | 缺少Channel ID                             |
| 11046 | 缺少密码                                   |
| 20113 | LIVE\_NOT\_EXSIT 直播源不存在              |
| 20110 | 无效密码                                   |
|20301  |channel_id错误（app_id填写正确）|



>备注：如遇到未在列表中的异常code，请联系我们的客服，客服会安排工程师进行解决。

### 常见问题

- **为什么H5播放视频拉伸变形了？**

    解答：H5并不具备拉伸视频的能力，请检查播放器的容器宽高是否设置正确

- **为什么提示“连接直播源失败！”**

    解答：播放连接视频直播地址，未收到响应，并重试5次后仍未成功将出现这个提示。这时需要确认视频是否在进行推流，网络是否通畅。

-  **QQ浏览器下无法在盖住视频**

    解答：浏览器接管了H5的视频播放功能，X5内核视频播放使用了自研的播放器，考虑用户体验，浏览器使用了统一的播放界面。相关信息参考[QQ浏览器文档说明](http://x5.tencent.com/guide?id=2009)

